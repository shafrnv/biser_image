<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бисер для Сонечки</title>
    <meta name="description" content="Софья творите, если что-то не понятно, пиши мне. Я всегда помогу!">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10" stroke-width="2" />
                        <circle cx="12" cy="12" r="6" stroke-width="2" />
                        <circle cx="12" cy="12" r="2" fill="currentColor" />
                    </svg>
                    Бисер
                </h1>
                <p class="tagline">Софья творите, если что-то не понятно, пиши мне. Я всегда помогу!
                    Если что-то надо доработать, то тоже обращайся обязательно!!!
                    Если вдруг интересно - то в математике это называется Концентрические кольца и Полярная система координат.
                    Это такие преобразования, которые афинные преобразования(масштаб и вращение) превращают в простое перемещение по осям координат(настоящее чудо планометрии)
                    <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BD%D1%86%D0%B5%D0%BD%D1%82%D1%80%D0%B8%D1%87%D0%BD%D1%8B%D0%B5_%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D1%8B" target="_blank">Вот, можешь вдохновиться)))</a>
                    Удачи тебе в твоих творениях. Обнимаю и Люблю!!! Ты звездочка, самая самая яркая и красивая!
                    <br><br>
                    <a href="https://xfloss.ru/" target="_blank" style="color: var(--primary-color); text-decoration: underline; font-weight: 600;">Генератор схем для вышивки крестиком →</a>
                    Оно работает лучше, как мне кажется. Проблема была в радианной вышивке, её я не нашел в интернете. Ну и я не знаю как тебе вообще удобнее, в каком представлении, как распечатать эту схему в итоге.
                    <br><br>
                    Скорее всего ты вообще этим пользоваться не будешь. Но насрать) Позанимался херный в пустоту, ничего нового) 
                </p>
                
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Upload Image -->
            <section class="step-section" id="uploadSection">
                <div class="step-header">
                    <span class="step-number">1</span>
                    <h2>Грузи картинку</h2>
                </div>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept="image/*" hidden>
                    <div class="upload-content">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <polyline points="17 8 12 3 7 8" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <line x1="12" y1="3" x2="12" y2="15" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <p class="upload-text">Можешь перетащить картинку сюда или <span class="upload-link">выбери
                                файл</span></p>
                        <p class="upload-hint">PNG, JPG, GIF вроде тоже можно</p>
                    </div>
                </div>
                <div class="upload-message hidden" id="uploadMessage">
                    <p>Изображение загружено и появилось ниже. Обрати внимание.</p>
                </div>
            </section>

            <!-- Step 2: Select Starting Point -->
            <section class="step-section hidden" id="selectPointSection">
                <div class="step-header">
                    <span class="step-number">2</span>
                    <h2>Выбери центр разбиения, откуда кружочки будут распространяться</h2>
                </div>
                <div class="image-adjustments">
                    <div class="adjustment-card">
                        <div class="adjustment-header">
                            <label for="brightnessInput">Яркость</label>
                            <button class="btn-reset" id="resetBrightnessBtn" title="Сбросить">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 3v5h-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 21v-5h5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        <input type="range" id="brightnessSlider" min="-100" max="100" value="0">
                        <input type="number" id="brightnessInput" min="-100" max="100" value="0">
                    </div>
                    <div class="adjustment-card">
                        <div class="adjustment-header">
                            <label for="contrastInput">Контрастность</label>
                            <button class="btn-reset" id="resetContrastBtn" title="Сбросить">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 3v5h-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 21v-5h5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        <input type="range" id="contrastSlider" min="-100" max="100" value="0">
                        <input type="number" id="contrastInput" min="-100" max="100" value="0">
                    </div>
                </div>
                <div class="canvas-hint" id="canvasHint">
                    <p>Кликни на изображение, чтобы выбрать центр разбиения</p>
                </div>
                <div class="image-resolution" id="imageResolution">
                    <p>Разрешение изображения: <span id="resolutionText">-</span></p>
                </div>
                <div class="canvas-container">
                    <canvas id="imageCanvas"></canvas>
                    <div class="canvas-overlay hidden" id="canvasOverlay"></div>
                </div>
            </section>

            <!-- Step 3: Configure Settings -->
            <section class="step-section hidden" id="settingsSection">
                <div class="step-header">
                    <span class="step-number">3</span>
                    <h2>Настрой параметры</h2>
                </div>
                <div class="image-resolution" id="imageResolutionSettings">
                    <p>Разрешение изображения: <span id="resolutionTextSettings">-</span></p>
                </div>
                <div class="mode-selector">
                    <label class="mode-option">
                        <input type="radio" name="beadMode" value="count" checked>
                        <span>Выбор количества бусинок</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="beadMode" value="size">
                        <span>Выбор размера бусинки</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="beadMode" value="both">
                        <span>Все опции вместе</span>
                    </label>
                </div>
                <div class="mode-selector" style="margin-top: var(--spacing-md);">
                    <label class="mode-option">
                        <input type="radio" name="fillMode" value="radial" checked>
                        <span>Круговое заполнение (для круговой вышивки)</span>
                    </label>
                    <label class="mode-option">
                        <input type="radio" name="fillMode" value="polar">
                        <span>Обычное заполнение (прямоугольная сетка)</span>
                    </label>
                </div>
                <div class="settings-grid">
                    <div class="setting-card" id="beadSizeCard">
                        <label for="beadSizeInput">Размер бусинки (пикселей)</label>
                        <input type="number" id="beadSizeInput" min="1" max="50" value="20">
                        <div class="slider-container">
                            <input type="range" id="beadSizeSlider" min="1" max="50" value="20">
                        </div>
                        <p class="setting-hint" id="beadSizeHint">Дополнительное масштабирование, применяемое к уже масштабированному изображению</p>
                    </div>
                    <div class="setting-card" id="beadsHorizontalCard">
                        <label for="beadsHorizontalInput">Бусинок по горизонтали</label>
                        <input type="number" id="beadsHorizontalInput" min="1" max="6400" value="40">
                        <div class="slider-container">
                            <input type="range" id="beadsHorizontalSlider" min="1" max="6400" value="40">
                        </div>
                        <p class="setting-hint" id="beadsHorizontalHint">Количество бусинок по ширине изображения</p>
                    </div>
                    <div class="setting-card" id="beadsVerticalCard">
                        <label for="beadsVerticalInput">Бусинок по вертикали</label>
                        <input type="number" id="beadsVerticalInput" min="1" max="4800" value="30">
                        <div class="slider-container">
                            <input type="range" id="beadsVerticalSlider" min="1" max="4800" value="30">
                        </div>
                        <p class="setting-hint" id="beadsVerticalHint">Количество бусинок по высоте изображения</p>
                    </div>
                    <div class="setting-card">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <label for="colorCountInput" style="margin: 0; flex: 1;">Количество цветов</label>
                            <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9rem; font-weight: normal; cursor: pointer;">
                                <input type="checkbox" id="limitColorsEnabled" checked style="cursor: pointer;">
                                <span>Ограничивать</span>
                            </label>
                        </div>
                        <input type="number" id="colorCountInput" min="2" max="50" value="10">
                        <div class="slider-container">
                            <input type="range" id="colorCountSlider" min="2" max="50" value="10">
                        </div>
                        <div class="setting-hint">Количество разных цветов бисера в схеме. Если не ограничивать, будут использованы все уникальные цвета изображения.</div>
                    </div>
                    <div class="setting-card">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <label for="colorDiversityInput" style="margin: 0; flex: 1;">Разнообразие цветов</label>
                            <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9rem; font-weight: normal; cursor: pointer;">
                                <input type="checkbox" id="colorDiversityEnabled" checked style="cursor: pointer;">
                                <span>Включено</span>
                            </label>
                        </div>
                        <input type="number" id="colorDiversityInput" min="0" max="100" value="30">
                        <div class="slider-container">
                            <input type="range" id="colorDiversitySlider" min="0" max="100" value="30">
                        </div>
                        <div class="setting-hint">
                            Минимальная разница между цветами (0-100).
                            Чем выше значение, тем более различимыми будут цвета.
                            При высоких значениях похожие оттенки будут объединяться.
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="generateBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    Создать схему
                </button>
            </section>

            <!-- Step 4: View Pattern -->
            <section class="step-section hidden" id="patternSection">
                <div class="step-header">
                    <span class="step-number">4</span>
                    <h2>Схема вышивания</h2>
                </div>
                <div class="pattern-controls">
                    <button class="btn btn-secondary" id="zoomInBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8" stroke-width="2" />
                            <path d="M21 21l-4.35-4.35M11 8v6M8 11h6" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Увеличить
                    </button>
                    <button class="btn btn-secondary" id="zoomOutBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8" stroke-width="2" />
                            <path d="M21 21l-4.35-4.35M8 11h6" stroke-width="2" stroke-linecap="round" />
                        </svg>
                        Уменьшить
                    </button>
                    <button class="btn btn-secondary" id="toggleGridBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="3" y="3" width="7" height="7" stroke-width="2" />
                            <rect x="14" y="3" width="7" height="7" stroke-width="2" />
                            <rect x="14" y="14" width="7" height="7" stroke-width="2" />
                            <rect x="3" y="14" width="7" height="7" stroke-width="2" />
                        </svg>
                        Сетка
                    </button>
                    <button class="btn btn-secondary" id="toggleLabelsBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke-width="2" />
                            <polyline points="14 2 14 8 20 8" stroke-width="2" />
                            <line x1="16" y1="13" x2="8" y2="13" stroke-width="2" />
                            <line x1="16" y1="17" x2="8" y2="17" stroke-width="2" />
                        </svg>
                        Надписи
                    </button>
                    <button class="btn btn-secondary" id="toggleConnectionsBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10" stroke-width="2" />
                            <line x1="12" y1="2" x2="12" y2="6" stroke-width="2" />
                            <line x1="12" y1="18" x2="12" y2="22" stroke-width="2" />
                            <line x1="4.93" y1="4.93" x2="7.76" y2="7.76" stroke-width="2" />
                            <line x1="16.24" y1="16.24" x2="19.07" y2="19.07" stroke-width="2" />
                            <line x1="2" y1="12" x2="6" y2="12" stroke-width="2" />
                            <line x1="18" y1="12" x2="22" y2="12" stroke-width="2" />
                            <line x1="4.93" y1="19.07" x2="7.76" y2="16.24" stroke-width="2" />
                            <line x1="16.24" y1="7.76" x2="19.07" y2="4.93" stroke-width="2" />
                        </svg>
                        Соединения
                    </button>
                    <div class="scale-control">
                        <label for="displayScaleInput">Масштаб: <span id="displayScaleValue">1.0x</span></label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="displayScaleInput" min="0.1" max="25" step="0.1" value="1" style="width: 80px; padding: 5px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-sm); color: var(--text-primary);">
                            <input type="range" id="displayScaleSlider" min="0.1" max="25" step="0.1" value="1" style="flex: 1;">
                        </div>
                    </div>
                    <button class="btn btn-primary" id="exportBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Экспорт
                    </button>
                </div>
                <div class="pattern-container">
                    <div class="pattern-canvas-wrapper" id="patternCanvasWrapper">
                        <canvas id="patternCanvas"></canvas>
                    </div>
                    <div class="pattern-sidebar">
                        <div class="color-palette-editor" id="colorPaletteEditor">
                            <h3>Редактор палитры</h3>
                            <div class="palette-info">
                                <p>Всего бусинок: <strong id="totalBeadsCount">0</strong></p>
                            </div>
                            <div id="paletteEditor"></div>
                            <button class="btn btn-secondary btn-small" id="addColorBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="10" stroke-width="2" />
                                    <path d="M12 8v8M8 12h8" stroke-width="2" stroke-linecap="round" />
                                </svg>
                                Добавить цвет
                            </button>
                            <button class="btn btn-primary btn-small" id="applyPaletteBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path
                                        d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                Применить изменения
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Color Picker Modal -->
        <div class="modal hidden" id="colorPickerModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Выбор цветов из изображения</h2>
                    <button class="modal-close" id="closeColorPicker">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="picker-tools">
                        <button class="btn btn-secondary" id="eyedropperBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path
                                    d="M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"
                                    stroke-width="2" />
                            </svg>
                            Пипетка
                        </button>
                        <button class="btn btn-secondary" id="areaSelectBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="3" width="18" height="18" stroke-width="2" stroke-dasharray="4 4" />
                            </svg>
                            Выбрать область
                        </button>
                        <div class="color-limit-control">
                            <label for="colorLimitInput">Макс. цветов:</label>
                            <input type="number" id="colorLimitInput" min="1" max="50" value="10">
                        </div>
                        <div class="color-limit-control">
                            <label for="pickerDiversityInput">Разнообразие:</label>
                            <input type="number" id="pickerDiversityInput" min="0" max="100" value="30"
                                title="Минимальная разница между цветами (0-100)">
                        </div>
                        <div class="color-limit-control">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="checkbox" id="pickerDiversityEnabled" checked style="cursor: pointer;">
                                <span>Включено</span>
                            </label>
                        </div>
                        <button class="btn btn-secondary" id="clearSelectionBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path
                                    d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                                    stroke-width="2" />
                            </svg>
                            Очистить
                        </button>
                    </div>
                    <div class="picker-canvas-wrapper">
                        <canvas id="pickerCanvas"></canvas>
                    </div>
                    <div class="selected-colors">
                        <h3>Выбранные цвета (<span id="selectedColorCount">0</span>)</h3>
                        <div id="selectedColorsList"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelColorPicker">Отмена</button>
                    <button class="btn btn-primary" id="addSelectedColors">Добавить цвета</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="spinner"></div>
            <p>Создание схемы...</p>
            <button class="btn btn-secondary" id="cancelGenerationBtn" style="margin-top: 20px;">
                Отмена
            </button>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>